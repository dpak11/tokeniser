<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Add Token to Header</title>
    <style>
        form span {
            display: block;
            padding: 5px;
        }
        input{
            padding: 5px;
            width: 160px;
        }
        div{
            width: 500px;
            overflow: scroll;
            height: 75px;
        }
        .hide{
            display: none
        }

    </style>
</head>

<body>
    <h2>Example 2: Create data token and insert it to Authorization Header</h2>
    <form>
        <span><input type="text" id="name" placeholder="Enter your name or email"></span>
        <span><input type="text" id="pass" placeholder="password"></span>
        <span><input type="text" id="descr" placeholder="Type some text..."></span>
        This token must auto-expire in <input type="text" id="expiry" placeholder="Enter number"> minutes
        <span><input type="submit" value="Submit"></span>
    </form>
    <div class="hide">
    </div>
    <p><a class="hide" id="readlink" href="/example2_read">Click here to read token from localStorage</a></p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <hr>
    <p><a href="/example2_create">Go to Example 1: Create data token and get token as query parameter</a></p>
    <script>
    const form = document.querySelector("form");
    const queryDiv = document.querySelector("div");
    const anchor = document.querySelector("#readlink");
    form.addEventListener("submit", (e) => {
        e.preventDefault();
        queryDiv.classList.add("hide");
        anchor.classList.add("hide");
        let _data = { name: form.name.value, pass: form.pass.value, descr: form.descr.value, expiry: `${form.expiry.value}m` };
        fetch("../create_headertoken", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(_data) })
            .then(data => data.json())
            .then(response => {
                if(response.token){                    
                    queryDiv.innerText = `Received below Token from Server. Token saved to your localStorage.\n
                    Authorization Bearer ${response.token}
                    `;
                    queryDiv.classList.remove("hide");
                    anchor.classList.remove("hide");
                    localStorage.setItem("tokie_example2",response.token)
                }else{
                    queryDiv.textContent = response.error;
                    queryDiv.classList.remove("hide");
                }
                
            });
    });
    
    </script>
</body>

</html>